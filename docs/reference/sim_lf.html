<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Simulate summary statistics from a specified factor structure"><title>Simulate summary statistics — sim_lf • GWASBrewer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate summary statistics — sim_lf"><meta property="og:description" content="Simulate summary statistics from a specified factor structure"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">GWASBrewer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.0237</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/effect_distribution.html">Controlling Effect Size Distributions</a>
    <a class="dropdown-item" href="../articles/resampling.html">Resampling and Re-Scaling Summary and Individual Level Data</a>
    <a class="dropdown-item" href="../articles/simulating_data.html">Simulating Data</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jean997/GWASBrewer/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulate summary statistics</h1>
      <small class="dont-index">Source: <a href="https://github.com/jean997/GWASBrewer/blob/HEAD/R/sim_lf.R" class="external-link"><code>R/sim_lf.R</code></a></small>
      <div class="d-none name"><code>sim_lf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Simulate summary statistics from a specified factor structure</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sim_lf</span><span class="op">(</span></span>
<span>  <span class="va">F_mat</span>,</span>
<span>  <span class="va">N</span>,</span>
<span>  <span class="va">J</span>,</span>
<span>  <span class="va">h2_trait</span>,</span>
<span>  <span class="va">omega</span>,</span>
<span>  <span class="va">h2_factor</span>,</span>
<span>  <span class="va">pi_L</span>,</span>
<span>  <span class="va">pi_theta</span>,</span>
<span>  est_s <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  R_E <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  R_obs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  R_LD <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  R_LD_eigen <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  af <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sporadic_pleiotropy <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  h2_exact <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  pi_exact <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  snp_effect_function_L <span class="op">=</span> <span class="st">"normal"</span>,</span>
<span>  snp_effect_function_theta <span class="op">=</span> <span class="st">"normal"</span>,</span>
<span>  snp_info <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>F_mat</dt>
<dd><p>factor matrix M by K (M = number of traits, K = number of factors)</p></dd>


<dt>N</dt>
<dd><p>GWAS sample size. N can be a scalar, vector, or matrix. If N is a scalar, all GWAS have the same sample size
and there is no overlap between studies. If N is a vector, each element of N specifies the sample size of the corresponding
GWAS and there is no overlap between studies. If N is a matrix, N_ii specifies the sample size of study i
and N_ij specifies the number of samples present in both study i and study j. The elements of N must be positive
but non-integer values will not generate an error.</p></dd>


<dt>J</dt>
<dd><p>Total number of SNPs to generate</p></dd>


<dt>h2_trait</dt>
<dd><p>Heritability of each trait. Length M vector.</p></dd>


<dt>omega</dt>
<dd><p>Proportion of trait heritability mediated by factors. Length M vector.</p></dd>


<dt>h2_factor</dt>
<dd><p>Heritability of each factor. Length K vector.</p></dd>


<dt>pi_L</dt>
<dd><p>Proportion of non-zero elements in L_k. Length K factor</p></dd>


<dt>pi_theta</dt>
<dd><p>Proportion of non-zero elements in theta. Scalar or length M vector.</p></dd>


<dt>est_s</dt>
<dd><p>If TRUE, return estimates of se(beta_hat).</p></dd>


<dt>R_E</dt>
<dd><p>Correlation between environmental trait components not mediated by factors. M by M pd matrix.</p></dd>


<dt>R_obs</dt>
<dd><p>Observational correlation between traits. M by M pd matrix. At most one of R_E and R_obs can be specified.</p></dd>


<dt>R_LD</dt>
<dd><p>List of LD blocks. R_LD should have class <code>list</code>.
Each element of R_LD can be either a) a matrix, b) a sparse matrix (class <code>dsCMatrix</code>) or c) an eigen decomposition (class <code>eigen</code>).
All elements should be correlation matrices, meaning that they have 1 on the diagonal and are positive definite.</p></dd>


<dt>R_LD_eigen</dt>
<dd><p>Optionally, also supply list of eigen decompositions. The program will not check that this matches R_LD.</p></dd>


<dt>af</dt>
<dd><p>Optional vector of allele frequencies. If R_LD is not supplied, af can be a scalar, vector or function.
If af is a function it should take a single argument (n) and return a vector of n allele frequencies (See Examples).
If R_LD is supplied, af must be a vector with length equal to the size of the supplied LD pattern (See Examples).</p></dd>


<dt>sporadic_pleiotropy</dt>
<dd><p>Allow sporadic pleiotropy between traits. Defaults to TRUE.</p></dd>


<dt>h2_exact</dt>
<dd><p>If TRUE, the heritability of each trait will be exactly h2.</p></dd>


<dt>pi_exact</dt>
<dd><p>If TRUE, the number of direct effect SNPs for each trait will be exactly equal to round(pi*J).</p></dd>


<dt>snp_effect_function_L, snp_effect_function_theta</dt>
<dd><p>Optional function to generate variant effects in <code>L</code> or <code>theta</code>.
<code>snp_effect_function_L/theta</code> can be a single function
or list of functions of length equal to the number of factors/number of traits.</p></dd>


<dt>snp_info</dt>
<dd><p>Optional <code>data.frame</code> of variant information to be passed to variant effect functions. If <code>R_LD</code> is
specified, <code>snp_info</code> should have number of rows equal to the size of the supplied LD pattern. Otherwise <code>snp_info</code>
should have <code>J</code> rows.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function will generate GWAS summary statistics for M traits with K common factors.
The matrix F_mat provides the effects of each factor on each trait, <code>F_mat[i,j]</code>
gives the effect of factor j on trait i. The rows of <code>F_mat</code> will be scaled in order
to provide desired proportion of heritability of each trait explained by factors but the relative
size and sign of elements within rows will be retained.</p>
<p>A random factor matrix can be generated using <code>generate_random_F</code> (see Examples).</p>
<p>It is possible to supply a non-feasible set of parameters.
Usually this occurs if the heritability of the factors is low but the heritability
of the traits is high leading to a contradiction. The function will return an error if this happens.</p>
<p>Trait covariance: Each trait is composed of four independent components, the genetic component mediated by factors,
the environmental component mediated by factors, the genetic component not mediated by factors,
and the environmental component not mediated by factors. Therefore, the total trait covariance can be decomposed into
the sum of four corresponding covariance matrices.</p>
<p>$$Cov(T) = Sigma_{FG} + Sigma_{FE} + Sigma_{GDir} + Sigma_{EDir}$$</p>
<p>We assume that all cross-trait genetic sharing is explained by the factors so that \(Sigma_{GDir}\) is diagonal.
Each factor is a sum of a genetic component and an environmental components and factors are independent
(both genetic and environmental components) are independent across factors. This means that
\(Sigma_{FG} = F S_{FG} F^T\) and \(Sigma_{FE} = F S_{FE} F^T\) where \(S_{FG}\) and \(S_{FE}\) are diagonal matrices. The parameter <code>R_E</code> specifies
the correlation of the residual environmental component (i.e. \(R_E = cov2cor(Sigma_{EDir}\)).
Alternatively, if <code>R_obs</code> is specified, \(Sigma_{EDir}\) will be chosen to give the desired observational correlation.
In the returned object, <code>Sigma_G</code> is equal to the sum of the two genetic covariance components and <code>Sigma_E</code>
is equal to the sum of the two environmental components.
<code>R</code> gives the overall trait correlation matrix multiplied by the overlap proportion matrix,
which is equal to the correlation in the error terms of <code>beta_hat</code> (See Examples).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">myF</span> <span class="op">&lt;-</span> <span class="fu"><a href="generate_random_F.html">generate_random_F</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, M <span class="op">=</span> <span class="fl">10</span>, nz_factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        h2_trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">10</span><span class="op">)</span>, pad <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">sim_lf</span><span class="op">(</span><span class="va">myF</span>, N <span class="op">=</span> <span class="fl">10000</span>, J <span class="op">=</span> <span class="fl">20000</span>, h2_trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">10</span><span class="op">)</span>, pi_L <span class="op">=</span> <span class="fl">0.1</span>, pi_theta <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> SNP effects provided for 20000 SNPs and 10 traits.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">myF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10000</span>, <span class="fl">8000</span>, <span class="fl">8000</span>, <span class="fl">10000</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">R_E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">sim_lf</span><span class="op">(</span>F_mat <span class="op">=</span> <span class="va">myF</span>, N <span class="op">=</span> <span class="va">N</span>, J <span class="op">=</span> <span class="fl">20000</span>, h2_trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, h2_factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             pi_L <span class="op">=</span> <span class="fl">0.1</span>, pi_theta <span class="op">=</span> <span class="fl">0.1</span>, R_E <span class="op">=</span> <span class="va">R_E</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> SNP effects provided for 20000 SNPs and 2 traits.</span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">R</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]      [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 1.0000000 0.1846886</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.1846886 1.0000000</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">beta_hat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">dat</span><span class="op">$</span><span class="va">beta_joint</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">dat</span><span class="op">$</span><span class="va">beta_hat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">dat</span><span class="op">$</span><span class="va">beta_joint</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.1809276</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jean Morrison.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

